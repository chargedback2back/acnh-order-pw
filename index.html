<script>
  const searchInput = document.getElementById('search');
  const itemList = document.getElementById('itemList');
  const output = document.getElementById('output');
  let items = {};

  fetch('acnh_long_ids.json')
    .then(response => response.json())
    .then(data => {
      items = data;
      renderList();
    });

  function renderList(filter = '') {
    itemList.innerHTML = '';
    Object.keys(items)
      .filter(name => name.toLowerCase().includes(filter.toLowerCase()))
      .forEach(name => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<label><input type='checkbox' value='${items[name]}' style='margin-right: 8px;'>${name}</label>`;
        div.onclick = function(e) {
          if (e.target.tagName !== 'INPUT') {
            const checkbox = div.querySelector('input');
            checkbox.checked = !checkbox.checked;
          }
        };
        itemList.appendChild(div);
      });
  }

  function generateOrder() {
    const checked = document.querySelectorAll('input[type="checkbox"]:checked');
    const codes = Array.from(checked).map(cb => cb.value);
    output.textContent = codes.length > 0 ? `$order ${codes.join(' ')}` : 'No items selected.';
    output.scrollIntoView({ behavior: 'smooth' });
  }

  function copyToClipboard() {
    const text = output.textContent;
    navigator.clipboard.writeText(text).then(() => {
      alert('Copied to clipboard!');
    });
  }

  function resetSelection() {
    searchInput.value = '';
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    output.textContent = '';
    renderList();
  }

  searchInput.addEventListener('input', e => renderList(e.target.value));

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
</script>
